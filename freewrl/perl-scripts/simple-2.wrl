#VRML V2.0 utf8

# Simple example fo perl scripting 
#
# Author : Etienne Grossmann <etienne@isr.ist.utl.pt>

# A sphere with a touch sensor
PROTO ClickSphere [
  eventIn  SFColor  the_color   # This event accepted (from script)
  eventOut SFTime   touched # This event emitted when touched
] {
  Transform {
    children [
      TouchSensor { touchTime IS touched }
      
      Shape { 
        appearance Appearance {material Material {diffuseColor IS the_color}}
        geometry Sphere { }
      }
    ]
  }
}

PROTO ToggleSphere [
] {
	Group {
		children [    
			
			# The sphere itself is here
			DEF TS ClickSphere { }

			# The script that receives pointer
			# events from the ClickSphere, updates
			# the state of the ToggleSphere

			DEF PS Script {
				eventIn  SFTime   touch_function
				eventOut SFColor  col
				url [
					"perl:
					touch_function => sub {
						
						# Set the eventOut 'col'
						$col = [ rand(), rand(), rand()];
						[];
					},
					initialize => sub {
						$col = [ rand(), rand(), rand()];
						[];
					}"
				]
			}
		]
		# Send touch event into script and
		# updated color into ClickSphere
		ROUTE TS.touched TO PS.touch_function
		ROUTE PS.col     TO TS.the_color
	}
}

ToggleSphere { }

